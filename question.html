<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PMP MOCK TEST - Question</title>
  <style>
    body { background:#f4f4f4; font-size:15px;}
    .container {
      max-width:820px; margin:36px auto; background:#fff; border-radius:18px; box-shadow:0 6px 32px rgba(0,0,0,0.08);
      padding:18px 18px 20px 18px;
    }
    .icon-main { text-align:center; margin-bottom:10px;}
    .icon-main svg { vertical-align:middle; width:34px; height:34px; margin-right:6px;}
    .icon-main span { font-size:1.1em; vertical-align:middle;}
    .title { font-size:1.23em; font-weight:bold; margin-bottom:12px; text-align:center; letter-spacing:0.01em;}
    .question-header-row { display:flex; align-items:center; justify-content:center; gap:18px; margin:18px 0 10px 0;}
    .question-big { font-size:1.09em; font-weight:bold; color:#1976d2;}
    .level-tag { font-size:1em; font-weight:bold; border-radius:5px; padding:5px 13px; margin-left:8px;}
    .level-Easy { background:#43a047; color:#fff;}
    .level-Moderate { background:#fbc02d; color:#fff;}
    .level-Difficult { background:#d32f2f; color:#fff;}
    .level-Expert { background:#8e24aa; color:#fff;}
    .summary-row { color:#666; font-size:1em; margin-bottom:11px; font-weight:bold;}
    .question-main { font-size:1em; margin-bottom:18px; font-weight:400;}
    .answers { margin-bottom:20px;}
    .answer-label { display:block; margin-bottom:13px; font-size:1em; font-weight:400;}
    .answer-label input[type="radio"], .answer-label input[type="checkbox"] { margin-right:10px; }
    .hint-row { margin-bottom:13px;}
    .hint-btn {
      font-size:0.95em; color:#1976d2; background:#e3f2fd; border:none; border-radius:7px; padding:6px 14px; margin-right:0; cursor:pointer;
      font-weight:500; box-shadow:0 1px 1.5px rgba(33,150,243,0.08);
      transition: background 0.2s;
      display:inline-block;
    }
    .hint-btn:hover { background:#bbdefb; }
    .answer-row { display:flex; align-items:center; margin-top:14px; margin-bottom:15px; gap:30px;}
    .answer-btn {
      background:#1976d2; color:#fff; border:none; border-radius:7px; font-size:1em; font-weight:600;
      padding:8px 26px; cursor:pointer; transition:background 0.2s; display:inline-block;
    }
    .answer-btn:hover { background:#0d47a1;}
    .toggle-explanation-link {
      color:#1976d2; background:none; border:none; font-size:1em; font-weight:bold;
      cursor:pointer; text-decoration:underline; margin-left:6px;
    }
    .toggle-explanation-link:hover { color:#0d47a1; }
    .status { font-weight:bold; display:inline-block; margin-left:18px; padding:2px 18px; border-radius:18px; font-size:1em;}
    .correct { background:#388e3c; color:#fff;}
    .incorrect { background:#fbc02d; color:#000;}
    .explanation { background:#fffde7; border-left:4px solid #fbc02d; padding:11px 14px; margin-top:12px; font-size:0.98em;}
    .correct-answer { color:#388e3c; font-weight:bold;}
    .reference { color:#6a1b9a; background:#ede7f6; display:inline-block; border-radius:6px; padding:3px 10px; font-size:0.95em; margin-bottom:8px; margin-top:4px;}
    .explanation-en { font-style:italic; color:#1976d2; margin-bottom:8px; margin-top:6px; }
    .explanation-vi { color:#222; margin-bottom:5px;}
    .action-buttons-row { display:flex; align-items:center; justify-content:space-between; margin-top:18px;}
    .pagination-controls { display:flex; align-items:center; gap:6px; }
    .pagination-page { font-size:1em; font-weight:bold; color:#1976d2; min-width:44px; text-align:center; }
    .nav-btn, .first-btn, .last-btn {
      padding:7px 14px; font-size:1em; border-radius:5px; border:none; font-weight:600;
      cursor:pointer; min-width:36px; margin-right:4px;
    }
    .nav-btn { background:#616161; color:#fff;}
    .first-btn, .last-btn { background:#2196f3; color:#fff;}
    .nav-btn:disabled, .first-btn:disabled, .last-btn:disabled { background:#bbb; color:#fff;}
    .list-btn {
      background:#388e3c; color:#fff; padding:8px 24px; border:none; border-radius:5px; font-size:1em; font-weight:600; cursor:pointer; margin-right:8px;
    }
    .end-btn {
      background:#d32f2f; color:#fff; padding:8px 24px; border:none; border-radius:5px; font-size:1em; font-weight:600; cursor:pointer;
    }
    .highlight-correct { background: #c8e6c9; font-weight: bold;}
    .highlight-incorrect { background: #fffde7; font-weight: bold;}
    @media (max-width: 950px) {
      .container {max-width:99vw; padding:2vw;}
      .question-big { font-size:1em;}
      .level-tag { font-size:1em; padding:6px 12px;}
      .answer-btn, .list-btn, .end-btn, .nav-btn, .first-btn, .last-btn { font-size:1em; padding:7px 10px;}
      .answer-label {font-size:1em;}
      .pagination-page { font-size:1em; min-width:38px;}
    }
  </style>
</head>
<body>
  <div class="container" id="main-container">
    <div class="icon-main">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><circle cx="32" cy="32" r="28" stroke="#1976d2" stroke-width="4" fill="#e3f2fd"/><text x="32" y="41" text-anchor="middle" font-size="32" fill="#1976d2" font-family="Arial" font-weight="bold">?</text></svg>
      <span>üìö</span>
    </div>
    <div class="title">PMP MOCK TEST</div>
    <div class="question-header-row">
      <span class="question-big" id="question-number"></span>
      <span class="level-tag" id="question-level"></span>
    </div>
    <div class="summary-row" id="question-summary"></div>
    <div class="question-main" id="question-main"></div>
    <form id="answers" class="answers"></form>
    <div class="hint-row">
      <button class="hint-btn" id="hint-btn">HINT: Ask ChatGPT</button>
    </div>
    <div class="answer-row">
      <button class="answer-btn" id="answer-btn">ANSWER</button>
      <button class="toggle-explanation-link" id="toggle-explanation" type="button">+ Show answer & explanation</button>
      <span id="status" class="status"></span>
    </div>
    <div id="explanation" class="explanation" style="display:none;"></div>
    <div class="action-buttons-row">
      <div class="pagination-controls">
        <button class="first-btn" id="btn-first">&laquo;</button>
        <button class="nav-btn" id="btn-prev">&lt;</button>
        <span class="pagination-page" id="page-label"></span>
        <button class="nav-btn" id="btn-next">&gt;</button>
        <button class="last-btn" id="btn-last">&raquo;</button>
      </div>
      <div>
        <button class="list-btn" id="btn-list">Back to list</button>
        <button class="end-btn" id="btn-end">End</button>
      </div>
    </div>
  </div>
  <script>
    let questions = [];
    let current = 0;
    let userAnswers = [];
    let checked = [];
    let showExplanation = [];
    function levelTag(level) {
      let txt = level || "Moderate";
      let className = "level-" + txt.charAt(0).toUpperCase() + txt.slice(1).toLowerCase();
      return `<span class="level-tag ${className}">${txt}</span>`;
    }
    function getMultiCount(text, options) {
      let lower = text.toLowerCase();
      let m = lower.match(/choose\s+(two|three|four|five|\d+|all)/) ||
              lower.match(/select\s+(two|three|four|five|\d+|all)/) ||
              lower.match(/(pick|mark)\s+(two|three|four|five|\d+|all)/);
      if (m) {
        let val = m[1] || m[2];
        if (val === "two") return 2;
        if (val === "three") return 3;
        if (val === "four") return 4;
        if (val === "five") return 5;
        if (val === "all") return options ? options.length : 2;
        if (!isNaN(val)) return Number(val);
      }
      return 1;
    }
    function renderQuestion() {
      const q = questions[current];
      let multiCount = getMultiCount(q.question, q.options);
      document.getElementById("question-number").textContent = `Question#${current+1}`;
      document.getElementById("question-level").innerHTML = levelTag(q.difficulty);
      document.getElementById("question-summary").innerHTML = `<b>Summary:</b> ${q.short||""}`;
      document.getElementById("question-main").innerHTML = q.question.replace(/\n/g,'<br>');
      let ansHtml = "";
      if (multiCount > 1) {
        let arr = Array.isArray(userAnswers[current]) ? userAnswers[current] : [];
        q.options.forEach((option, i) => {
          ansHtml += `<label class="answer-label" id="label${i}">
            <input type="checkbox" name="q${current}" value="${i}" ${(arr.includes(i)) ? 'checked' : ''} ${checked[current] ? 'disabled' : ''} onchange="updateMultiAnswer(${i})">
            ${String.fromCharCode(65+i)}. ${option}
          </label>`;
        });
      } else {
        q.options.forEach((option, i) => {
          ansHtml += `<label class="answer-label" id="label${i}">
            <input type="radio" name="q${current}" value="${i}" ${userAnswers[current] == i ? 'checked' : ''} ${checked[current] ? 'disabled' : ''} onchange="updateSingleAnswer(${i})">
            ${String.fromCharCode(65+i)}. ${option}
          </label>`;
        });
      }
      document.getElementById("answers").innerHTML = ansHtml;
      document.getElementById("status").textContent = "";
      document.getElementById("toggle-explanation").innerHTML = "+ Show answer & explanation";
      document.getElementById("explanation").style.display = showExplanation[current] ? "block" : "none";
      let expHtml = "";
      if (multiCount > 1 && Array.isArray(q.correct)) {
        expHtml = `<span class="correct-hint">ƒê√°p √°n ƒë√∫ng</span>: <span class="correct-answer">${q.correct.map(idx=>String.fromCharCode(65+idx)+'. '+q.options[idx]).join(', ')}</span><br>`;
      } else {
        expHtml = `<span class="correct-hint">ƒê√°p √°n ƒë√∫ng</span>: <span class="correct-answer">${String.fromCharCode(65+q.correct)}. ${q.options[q.correct]}</span><br>`;
      }
      if(q.reference) expHtml += `<span class="reference">Tham kh·∫£o: ${q.reference.replace(/\n/g,"<br>")}</span><br>`;
      if(q.explanation_en) expHtml += `<div class="explanation-en">Gi·∫£i th√≠ch EN: ${q.explanation_en.replace(/\n/g,"<br>")}</div>`;
      if(q.explanation_vi) expHtml += `<div class="explanation-vi">Gi·∫£i th√≠ch Vi: ${q.explanation_vi.replace(/\n/g,"<br>")}</div>`;
      document.getElementById("explanation").innerHTML = expHtml;
      document.getElementById("page-label").textContent = `${current+1} / ${questions.length}`;
      document.getElementById("btn-first").disabled = current===0;
      document.getElementById("btn-prev").disabled = current===0;
      document.getElementById("btn-next").disabled = current===questions.length-1;
      document.getElementById("btn-last").disabled = current===questions.length-1;
      if(checked[current]) showCheckResult();
    }
    // Nh·∫≠n ƒë√°p √°n radio (1 l·ª±a ch·ªçn)
    window.updateSingleAnswer = function(i) {
      userAnswers[current] = i;
      localStorage.setItem('pmp_userAnswers', JSON.stringify(userAnswers));
    };
    // Nh·∫≠n ƒë√°p √°n checkbox (nhi·ªÅu l·ª±a ch·ªçn)
    window.updateMultiAnswer = function(i) {
      let arr = Array.isArray(userAnswers[current]) ? userAnswers[current] : [];
      let checkbox = document.querySelector('input[type=checkbox][name="q'+current+'"][value="'+i+'"]');
      if (checkbox.checked) {
        if (!arr.includes(i)) arr.push(i);
      } else {
        arr = arr.filter(x=>x!==i);
      }
      userAnswers[current] = arr;
      localStorage.setItem('pmp_userAnswers', JSON.stringify(userAnswers));
      // C·∫•m tick th√™m n·∫øu ƒë·ªß s·ªë l∆∞·ª£ng
      const q = questions[current];
      let multiCount = getMultiCount(q.question, q.options);
      let boxes = document.querySelectorAll('input[type=checkbox][name="q'+current+'"]');
      boxes.forEach(box=>{
        if(!arr.includes(Number(box.value)) && arr.length>=multiCount){
          box.disabled = true;
        } else {
          box.disabled = false;
        }
      });
    };

    function showCheckResult() {
      const q = questions[current];
      const multiCount = getMultiCount(q.question, q.options);
      const status = document.getElementById('status');
      for (let i = 0; i < q.options.length; i++) {
        document.getElementById('label'+i).classList.remove("highlight-correct","highlight-incorrect");
      }
      let correct = (multiCount > 1 && Array.isArray(q.correct)) ? q.correct : [q.correct];
      let chosen = (multiCount > 1) ? (Array.isArray(userAnswers[current]) ? userAnswers[current] : []) : [userAnswers[current]];
      let isCorrect = false;
      if (multiCount > 1) {
        isCorrect = Array.isArray(q.correct) && chosen.length === q.correct.length &&
          q.correct.every(idx=>chosen.includes(idx));
      } else {
        isCorrect = chosen[0] === correct[0];
      }
      if (isCorrect) {
        status.textContent = "CORRECT";
        status.className = "status correct";
        correct.forEach(idx=>{
          document.getElementById('label'+idx).classList.add("highlight-correct");
        });
      } else {
        status.textContent = "INCORRECT";
        status.className = "status incorrect";
        chosen.forEach(idx=>{
          if(idx!=null)document.getElementById('label'+idx).classList.add("highlight-incorrect");
        });
        correct.forEach(idx=>{
          document.getElementById('label'+idx).classList.add("highlight-correct");
        });
      }
      let inputs = document.querySelectorAll('.answers input');
      for (let i = 0; i < inputs.length; i++) inputs[i].disabled = true;
    }
    document.getElementById("answer-btn").onclick = function(e) {
      const q = questions[current];
      let multiCount = getMultiCount(q.question, q.options);
      if (checked[current]) return;
      let status = document.getElementById('status');
      if (multiCount > 1) {
        let boxes = document.querySelectorAll('input[type=checkbox][name="q'+current+'"]');
        let arr = [];
        boxes.forEach(b=>{ if(b.checked) arr.push(Number(b.value)); });
        if (arr.length < multiCount) {
          status.textContent = `Please choose ${multiCount} answers!`;
          status.className = "status";
          return;
        }
        userAnswers[current] = arr;
      } else {
        let radios = document.getElementsByName('q'+current);
        let chosen = null;
        for (let i = 0; i < radios.length; i++) {
          if (radios[i].checked) { chosen = parseInt(radios[i].value); break; }
        }
        if (chosen === null) {
          status.textContent = "Please choose an answer!";
          status.className = "status";
          return;
        }
        userAnswers[current] = chosen;
      }
      checked[current] = true;
      showCheckResult();
      localStorage.setItem('pmp_userAnswers', JSON.stringify(userAnswers));
      localStorage.setItem('pmp_checked', JSON.stringify(checked));
    };
    document.getElementById("toggle-explanation").onclick = function() {
      showExplanation[current] = !showExplanation[current];
      document.getElementById("explanation").style.display = showExplanation[current] ? "block" : "none";
      this.innerHTML = showExplanation[current] ? "- Hide answer & explanation" : "+ Show answer & explanation";
    };
    document.getElementById("hint-btn").onclick = function() {
      const q = questions[current];
      let prompt = `Ph√¢n t√≠ch c√¢u h·ªèi PMP sau, gi·∫£i th√≠ch chi ti·∫øt b·∫±ng ti·∫øng Vi·ªát v√† l√Ω do ch·ªçn, kh√¥ng ch·ªçn t·ª´ng ƒë√°p √°n.\n\nC√¢u h·ªèi:\n${q.question}\n\nC√°c ƒë√°p √°n:\n${q.options.map((opt, i)=>String.fromCharCode(65+i)+'. '+opt).join('\n')}`;
      if (navigator.clipboard) {
        navigator.clipboard.writeText(prompt).then(function() {
          window.open("https://chat.openai.com/", "_blank"); alert("Prompt ƒë√£ ƒë∆∞·ª£c copy v√†o clipboard. H√£y d√°n (Ctrl+V) v√†o √¥ chat ChatGPT!");
        }, function() {
          alert("Kh√¥ng copy ƒë∆∞·ª£c prompt, h√£y t·ª± copy:\n\n" + prompt); window.open("https://chat.openai.com/", "_blank");
        });
      } else {
        alert("H√£y t·ª± copy prompt sau v√† d√°n v√†o ChatGPT:\n\n" + prompt); window.open("https://chat.openai.com/", "_blank");
      }
    };
    document.getElementById("btn-first").onclick = function() { if(current>0){current=0;renderQuestion();} };
    document.getElementById("btn-prev").onclick = function() { if(current>0){current--;renderQuestion();} };
    document.getElementById("btn-next").onclick = function() { if(current<questions.length-1){current++;renderQuestion();} };
    document.getElementById("btn-last").onclick = function() { if(current<questions.length-1){current=questions.length-1;renderQuestion();} };
    document.getElementById("btn-list").onclick = function() { window.location.href = "questionsList.html"; };
    document.getElementById("btn-end").onclick = function() {
      localStorage.setItem('pmp_userAnswers', JSON.stringify(userAnswers));
      localStorage.setItem('pmp_checked', JSON.stringify(checked));
      window.location.href = "result.html";
    };
    window.onload = function() {
      let raw = localStorage.getItem('pmp_questions');
      if (!raw) { window.location.href = "index.html"; return; }
      questions = JSON.parse(raw);
      userAnswers = JSON.parse(localStorage.getItem('pmp_userAnswers')||"null") || Array(questions.length).fill(null);
      checked = JSON.parse(localStorage.getItem('pmp_checked')||"null") || Array(questions.length).fill(false);
      showExplanation = Array(questions.length).fill(false);
      current = parseInt(localStorage.getItem('pmp_current_idx') || "0", 10);
      renderQuestion();
    };
  </script>
</body>
</html>